import{y as K,u as pe,d as _e,e as d,z as Q,p as we,j as k,r as i,o as p,f as W,g as r,a as l,w as a,i as o,F as ge,c as w,t as ye,m as Ce,b as n,h as Ve,I as h}from"./index-9iHmKBEN.js";import{u as xe,a as q}from"./vee-validate.esm-qMoNrkvc.js";const be=r("h1",{class:"text-3xl mt-3"},"Settings",-1),ke=r("p",{class:"mt-5 text-xl"},"Account info",-1),he={class:"mt-5"},Pe=r("p",{class:"text-xl"},"Profile picture",-1),Ue={class:"flex gap-10 items-center"},De={key:0,class:"text-4xl"},Ae={class:"flex flex-col justify-between items-center gap-2"},$e=r("p",{class:"text-xl"},"Full name",-1),Se=r("p",{class:"text-xl"},"username",-1),ze=r("p",{class:"text-xl"},"Email",-1),Me={class:"flex justify-end gap-3"},Fe=r("p",{class:"text-xl"},"Change password",-1),Ze=r("p",{class:"text-xl text-error mt-5"},"Delete account",-1),Ne=r("p",null,"Current Password",-1),Te=r("p",null,"New Password",-1),je=r("p",null,"New Password Confirmation",-1),Be={class:"flex justify-end gap-2"},Ye={__name:"Settings",setup(Ee){var Y;const m=K(),O=pe(),f=_e(),P=d(!1),X=K(),u=d({}),U=d(""),z=d(""),M=d(""),ee=Q(()=>U.value===z.value),C=d(!1),g=d(),V=d(!1),D=d(!1),c=d(!1),A=d(!1),F=d(""),Z=d(!1),le=Q(()=>U.value.length>7&&z.value.length>7&&M.value.length>7),E=[t=>!!t||"Required.",t=>t&&t.length>=8||"Min 8 characters",t=>/\d/.test(t)&&/[a-zA-Z]/.test(t)||"Password must contain at least one letter and one number"],ae=()=>{k.post("/auth/change-password",{email:$.value.value,password:M.value,newPassword:U.value},{withCredentials:!0}).then(t=>{f.success("Password was changed successfully"),P.value=!1}).catch(t=>{f.error("failed - check your current password and try again!")})},{handleSubmit:N,resetForm:te,handleReset:Ie,isSubmitting:Re,values:Le}=xe({validationSchema:{name(t){return(t==null?void 0:t.length)>=2?!0:"Please enter your full name"},username(t){return(t==null?void 0:t.length)>=2&&/^[a-zA-Z0-9](?!.*[._]{2})[a-zA-Z0-9._]{0,28}[a-zA-Z0-9]$/i.test(t)?!0:"Please enter a valid username"},email(t){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/i.test(t)?!0:"Please enter a valid email"}},initialValues:{name:(Y=m.user)==null?void 0:Y.name,email:u.value.email,username:u.value.username}}),se=()=>{c.value=!0,k.post(`/users/${u.value.id}`,{password:F.value},{withCredentials:!0}).then(t=>{A.value=!1,m.$reset(),O.push("/login")}).catch(t=>{f.error("failed - check your password and try again!")}).finally(()=>{c.value=!1})},$=q("email"),T=q("name"),j=q("username"),x=d(!1),b=d(!1);we(async()=>{await X.getUser(),u.value={...m.user},te({values:{name:u.value.name,username:u.value.username,email:u.value.email}})});const oe=N(()=>{c.value=!0,k.put(`/users/deleteProfilePic/${u.value.id}`,{file:null},{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}).then(t=>{f.success("user updated successfully"),m.assignUser(t.data),m.user=t.data,D.value=!1,g.value=null}).catch(t=>{f.error("An error occurred")}).finally(()=>{c.value=!1})}),re=N(()=>{c.value=!0,k.put(`/users/${u.value.id}`,{file:g.value?g.value:null},{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}).then(t=>{f.success("user updated successfully"),m.assignUser(t.data),m.user=t.data,V.value=!1,g.value=null}).catch(t=>{f.error("An error occurred")}).finally(()=>{c.value=!1})}),ne=N(()=>{c.value=!0,k.put(`/users/${u.value.id}`,{name:T.value.value,username:j.value.value,email:$.value.value},{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}).then(t=>{f.success("user updated successfully"),m.assignUser(t.data),m.user=t.data,V.value=!1,g.value=null}).catch(t=>{f.error("An error occurred")}).finally(()=>{c.value=!1})}),ue=async()=>{Z.value=!0;try{await k.post("/auth/send-verification-email"),f.success("Verification email was sent")}catch{f.error("Something went wrong!")}finally{Z.value=!1}};return(t,e)=>{const _=i("v-col"),de=i("v-img"),ie=i("v-avatar"),v=i("v-btn"),S=i("v-row"),y=i("v-text-field"),ce=i("v-form"),G=i("v-divider"),I=i("v-card-title"),R=i("v-card-text"),L=i("v-card"),B=i("v-dialog"),ve=i("DeleteModal"),me=i("v-file-input"),H=i("v-card-actions");return p(),W(ge,null,[be,ke,r("div",he,[l(ce,{onSubmit:o(N)},{default:a(()=>[l(S,{class:"border-t border-b items-center"},{default:a(()=>[l(_,{md:"4",cols:"12"},{default:a(()=>[Pe]),_:1}),(p(),w(_,{md:"5",cols:"12",key:u.value},{default:a(()=>[r("div",Ue,[l(ie,{color:"primary",class:"",size:80},{default:a(()=>{var s;return[!u.value.profilePhotoUrl&&u.value.name?(p(),W("p",De,ye(u.value.name[0].toUpperCase()),1)):(p(),w(de,{key:1,src:(s=o(m).user)==null?void 0:s.profilePhotoUrl},null,8,["src"]))]}),_:1}),r("div",Ae,[l(v,Ce(t.props,{onClick:e[0]||(e[0]=s=>V.value=!0)}),{default:a(()=>[n("Change")]),_:1},16),l(v,{color:"error",onClick:e[1]||(e[1]=s=>D.value=!0),disabled:!u.value.profilePhotoUrl},{default:a(()=>[n("Delete")]),_:1},8,["disabled"])])])]),_:1}))]),_:1}),l(S,{class:"items-center"},{default:a(()=>[l(_,{md:"4",cols:"12"},{default:a(()=>[$e]),_:1}),l(_,{md:"8",cols:"12"},{default:a(()=>[l(y,{name:"name",modelValue:o(T).value.value,"onUpdate:modelValue":e[2]||(e[2]=s=>o(T).value.value=s),"error-messages":o(T).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),l(S,{class:"items-center"},{default:a(()=>[l(_,{md:"4",cols:"12"},{default:a(()=>[Se]),_:1}),l(_,{md:"8",cols:"12"},{default:a(()=>[l(y,{modelValue:o(j).value.value,"onUpdate:modelValue":e[3]||(e[3]=s=>o(j).value.value=s),"error-messages":o(j).errorMessage.value,prefix:"@"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),l(S,{class:"items-center"},{default:a(()=>[l(_,{md:"4",cols:"12"},{default:a(()=>[ze]),_:1}),l(_,{md:"8",cols:"12"},{default:a(()=>{var s,J;return[l(y,{readonly:"",disabled:(s=o(m).user)==null?void 0:s.isEmailVerified,modelValue:o($).value.value,"onUpdate:modelValue":e[4]||(e[4]=fe=>o($).value.value=fe),"error-messages":o($).errorMessage.value},null,8,["disabled","modelValue","error-messages"]),(J=o(m).user)!=null&&J.isEmailVerified?Ve("",!0):(p(),w(v,{key:0,disabled:Z.value,loading:Z.value,onClick:ue,color:"primary",variant:"flat"},{default:a(()=>[n(" Verify ")]),_:1},8,["disabled","loading"]))]}),_:1})]),_:1}),l(S,{class:"items-center"},{default:a(()=>[l(_,{cols:"12",class:"flex flex-col justify-end"},{default:a(()=>[r("div",Me,[l(v,{color:"primary",onClick:e[5]||(e[5]=()=>o(O).go(-1)),variant:"outlined"},{default:a(()=>[n("Cancel")]),_:1}),l(v,{color:"primary",onClick:o(ne)},{default:a(()=>[n("Save")]),_:1},8,["onClick"])])]),_:1})]),_:1})]),_:1},8,["onSubmit"]),Fe,l(G,{class:"mt-2 border-2 border-black dark:border-white"}),l(v,{onClick:e[6]||(e[6]=s=>P.value=!0),class:"mt-2"},{default:a(()=>[n(" Change password ")]),_:1}),Ze,l(G,{class:"mt-2 border-2 border-black dark:border-white"}),l(v,{class:"mt-2",color:"error",onClick:e[7]||(e[7]=s=>A.value=!0)},{default:a(()=>[n(" Delete account ")]),_:1})]),l(B,{modelValue:P.value,"onUpdate:modelValue":e[18]||(e[18]=s=>P.value=s),class:"md:max-w-[40vw] w-full"},{default:a(()=>[l(L,null,{default:a(()=>[l(I,null,{default:a(()=>[n(" Change password ")]),_:1}),l(R,{class:"space-y-4 flex flex-col"},{default:a(()=>[r("div",null,[Ne,l(y,{rules:E,modelValue:M.value,"onUpdate:modelValue":e[10]||(e[10]=s=>M.value=s),type:C.value?"text":"password"},{"append-inner":a(()=>[C.value?(p(),w(o(h),{key:0,onClick:e[8]||(e[8]=()=>C.value=!C.value),icon:"ph:eye-closed-bold",width:"30",class:"cursor-pointer"})):(p(),w(o(h),{key:1,onClick:e[9]||(e[9]=()=>C.value=!C.value),icon:"ph:eye-bold",width:"30",class:"cursor-pointer"}))]),_:1},8,["modelValue","type"])]),r("div",null,[Te,l(y,{rules:E,modelValue:U.value,"onUpdate:modelValue":e[13]||(e[13]=s=>U.value=s),type:x.value?"text":"password"},{"append-inner":a(()=>[x.value?(p(),w(o(h),{key:0,onClick:e[11]||(e[11]=()=>x.value=!x.value),icon:"ph:eye-closed-bold",width:"30",class:"cursor-pointer"})):(p(),w(o(h),{key:1,onClick:e[12]||(e[12]=()=>x.value=!x.value),icon:"ph:eye-bold",width:"30",class:"cursor-pointer"}))]),_:1},8,["modelValue","type"])]),r("div",null,[je,l(y,{rules:E,modelValue:z.value,"onUpdate:modelValue":e[16]||(e[16]=s=>z.value=s),type:b.value?"text":"password"},{"append-inner":a(()=>[b.value?(p(),w(o(h),{key:0,onClick:e[14]||(e[14]=()=>b.value=!b.value),icon:"ph:eye-closed-bold",width:"30",class:"cursor-pointer"})):(p(),w(o(h),{key:1,onClick:e[15]||(e[15]=()=>b.value=!b.value),icon:"ph:eye-bold",width:"30",class:"cursor-pointer"}))]),_:1},8,["modelValue","type"])]),r("div",Be,[l(v,{variant:"outlined",color:"primary",onClick:e[17]||(e[17]=s=>P.value=!1)},{default:a(()=>[n(" Cancel ")]),_:1}),l(v,{color:"primary",onClick:ae,disabled:!ee.value||!le.value},{default:a(()=>[n(" Change ")]),_:1},8,["disabled"])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(B,{modelValue:D.value,"onUpdate:modelValue":e[21]||(e[21]=s=>D.value=s),class:"md:max-w-[50vw] w-full"},{default:a(()=>[l(ve,{"is-loading":c.value,title:"Delete Profile Picture",actionBtnText:"Delete",text:"Your profile picture will be deleted",onCancel:e[19]||(e[19]=s=>D.value=!1),onDelete:e[20]||(e[20]=()=>{g.value=null,o(oe)()})},null,8,["is-loading"])]),_:1},8,["modelValue"]),l(B,{modelValue:V.value,"onUpdate:modelValue":e[24]||(e[24]=s=>V.value=s),class:"md:max-w-[50vw] w-full"},{default:a(()=>[l(L,null,{default:a(()=>[l(I,null,{default:a(()=>[n(" Change your profile picture ")]),_:1}),l(R,null,{default:a(()=>[l(me,{modelValue:g.value,"onUpdate:modelValue":e[22]||(e[22]=s=>g.value=s),accept:"image/*",label:"Profile Picture",variant:"solo-filled"},null,8,["modelValue"])]),_:1}),l(H,{class:"self-end"},{default:a(()=>[l(v,{variant:"outlined",color:"primary",onClick:e[23]||(e[23]=s=>V.value=!1)},{default:a(()=>[n(" Cancel ")]),_:1}),l(v,{onClick:o(re),disabled:c.value,loading:c.value,variant:"flat",color:"primary"},{default:a(()=>[n(" Update ")]),_:1},8,["onClick","disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(B,{modelValue:A.value,"onUpdate:modelValue":e[27]||(e[27]=s=>A.value=s),class:"md:max-w-[50vw] w-full"},{default:a(()=>[l(L,null,{default:a(()=>[l(I,null,{default:a(()=>[n(" Delete your account? ")]),_:1}),l(R,null,{default:a(()=>[n(" Are you sure you want to delete you account? "),l(y,{modelValue:F.value,"onUpdate:modelValue":e[25]||(e[25]=s=>F.value=s),label:"password"},null,8,["modelValue"])]),_:1}),l(H,{class:"self-end"},{default:a(()=>[l(v,{variant:"outlined",color:"primary",onClick:e[26]||(e[26]=s=>A.value=!1)},{default:a(()=>[n(" Cancel ")]),_:1}),l(v,{onClick:se,disabled:c.value||F.value.length<1,loading:c.value,variant:"flat",color:"error"},{default:a(()=>[n(" Delete ")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}};export{Ye as default};
